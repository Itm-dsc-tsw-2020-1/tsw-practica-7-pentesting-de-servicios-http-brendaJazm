#BRENDA JAZMIN GUZMAN DOMINGUEZ
#PARTE 1 - CONEXIÓN HTTP
"""
import requests
respuesta = requests.get('http://sagitario.itmorelia.edu.mx/~rogelio/hola.htm')
if respuesta.status_code == 200:
    print("CONEXIÓN LISTA")
    print(respuesta.text)
else :
    print("NO HAY CONEXIÓN")
"""

import os
import requests
import mysql.connector as mysql
from bs4 import BeautifulSoup 

conexion = mysql.connect( host='localhost', user= 'root', passwd='', db='escaneo' ) #COMPUTADORAS EN BASE DE DATOS
operacion = conexion.cursor()
operacion.execute( "SELECT ip FROM puertos WHERE servicio ='http' ")
for ip in operacion.fetchall() :
    print (ip)
conexion.close()
icom = str(ip[0])
try:
    respuesta = requests.get("http://" + icom) #GET
    print("Conexión Exitosaaaaa con : "+ icom + " !!!")
    print(respuesta.text)
except:
    print("")
"""
#BUSCANDO ETIQUETAS A HREF
print("---ETIQUETAS a href ENCONTRADAS---")
soup =  BeautifulSoup(respuesta.text , "lxml")
tags = soup('a')
for tag in tags:
    print(tag.get('href'))
print("-----------------------------------------")
#BUSCANDO ETIQUETAS FORM
soup = BeautifulSoup(respuesta.text, "lxml")
print("---ETIQUETAS FORM ENCONTRADAS---")
print(soup.find_all('form'))
"""
print("--------PARTE DOS BUSCAR ETIQUETAS FORM-------")
print("-----------------------------------------")
#BUSCANDO ETIQUETAS FORM
soup = BeautifulSoup(respuesta.text, "lxml")
print("ETIQUETAS FORM ENCONTRADAS")
print(soup.find_all('form'))


#BUSCANDO ETIQUETAS A HREF
print("-----------------------------------------")
print("ETIQUETAS A HREF ENCONTRADAS")
r = soup.find_all('a')
for i in r:
    print(i['href'])
    conexion = mysql.connect( host='localhost', user= 'root', passwd='', db='escaneo')
    operacion = conexion.cursor()
    sql = "INSERT INTO enlaces (ip, enlace) VALUES ('"+icom+"','"+i['href']+"')"
    operacion.execute(sql)
    conexion.commit()
 
    
    
    
    
